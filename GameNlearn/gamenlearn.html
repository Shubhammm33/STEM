<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM Learning App Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .bulb.on { filter: drop-shadow(0 0 1rem yellow); }
        @keyframes feedback-pop { 0% { transform: scale(0.8); opacity: 0; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        .feedback-animation { animation: feedback-pop 0.5s ease-out forwards; }
        
        /* Math Path Specific Styles */
        @keyframes shake { 0%, 100% { transform: translateX(0) rotate(0); } 20% { transform: translateX(-5px) rotate(-5deg); } 40% { transform: translateX(5px) rotate(5deg); } 60% { transform: translateX(-5px) rotate(-5deg); } 80% { transform: translateX(5px) rotate(5deg); } }
        .shake-animation { animation: shake 0.5s ease-in-out; }
        
        /* Neon theme for Math Path stones */
        .stone-neon {
            box-shadow: 0 0 5px theme('colors.cyan.400'), 0 0 10px theme('colors.cyan.500');
            border-color: theme('colors.cyan.300');
            background-color: theme('colors.gray.800');
            color: theme('colors.cyan.200');
        }
    </style>
</head>
<body class="bg-slate-100 font-sans antialiased">

    <div id="app-container" class="max-w-md mx-auto bg-white shadow-lg min-h-screen">

        <div id="login-page" class="p-6">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-600" data-key="app_title">STEM Spark</h1>
                <p class="text-slate-500" data-key="app_subtitle">Your Journey into Science & Tech</p>
                <div class="mt-4 flex justify-center space-x-2">
                    <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="en">English</button>
                    <button onclick="setLanguage('hi')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                    <button onclick="setLanguage('mr')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
                </div>
            </header>
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-3 text-slate-700" data-key="student_login_title">Student Login</h2>
                <form id="student-login-form" class="space-y-4">
                    <input type="text" id="school-code" class="w-full p-3 border rounded-md" data-key-placeholder="placeholder_school_code" required>
                    <input type="text" id="student-id" class="w-full p-3 border rounded-md" data-key-placeholder="placeholder_student_id" required>
                    <select id="student-standard" class="w-full p-3 border rounded-md bg-white">
                        <option value="6" data-key="standard_6">Standard 6</option>
                        <option value="7" data-key="standard_7">Standard 7</option>
                        <option value="8" data-key="standard_8">Standard 8</option>
                        <option value="9" data-key="standard_9">Standard 9</option>
                        <option value="10" data-key="standard_10">Standard 10</option>
                        <option value="11" data-key="standard_11">Standard 11</option>
                        <option value="12" data-key="standard_12">Standard 12</option>
                    </select>
                    <input type="password" id="student-password" class="w-full p-3 border rounded-md" data-key-placeholder="placeholder_password" required>
                    <button type="submit" class="w-full bg-blue-500 text-white p-3 rounded-md font-bold hover:bg-blue-600" data-key="login_button">Login</button>
                </form>
            </div>
            <div>
                <h2 class="text-xl font-semibold mb-3 text-slate-700" data-key="teacher_login_title">Teacher Login</h2>
                <form id="teacher-login-form" class="space-y-4">
                    <input type="email" id="teacher-email" class="w-full p-3 border rounded-md" data-key-placeholder="placeholder_email" required>
                    <input type="password" id="teacher-password" class="w-full p-3 border rounded-md" data-key-placeholder="placeholder_password" required>
                    <button type="submit" class="w-full bg-green-500 text-white p-3 rounded-md font-bold hover:bg-green-600" data-key="login_button">Login</button>
                </form>
            </div>
            <p id="login-error" class="text-red-500 text-center mt-4 hidden"></p>
        </div>

        <div id="student-home-page" class="p-6 hidden">
            <header class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800" data-key="welcome">Welcome, Student!</h1>
                    <p class="text-slate-500" data-key="home_subtitle">Choose your adventure</p>
                </div>
                <button onclick="logout()" class="text-sm text-red-500 font-semibold flex-shrink-0" data-key="logout_button">Logout</button>
            </header>
            <div class="mb-6 flex justify-center space-x-2">
                <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="en">English</button>
                <button onclick="setLanguage('hi')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                <button onclick="setLanguage('mr')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
            </div>
            <div class="space-y-4">
                <div onclick="showPage('stem-village-page')" class="bg-blue-500 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:bg-blue-600 transition">
                    <h2 class="text-xl font-bold" data-key="mode1_title">STEM Village Simulator</h2>
                    <p class="mt-1 text-blue-100" data-key="mode1_desc">Build a village by mastering STEM concepts.</p>
                </div>
                <div onclick="showPage('knowledge-battle-page')" class="bg-orange-500 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:bg-orange-600 transition">
                    <h2 class="text-xl font-bold" data-key="mode2_title">Knowledge Battle (‡§ú‡•ç‡§û‡§æ‡§® ‡§Ø‡•Å‡§¶‡•ç‡§ß)</h2>
                    <p class="mt-1 text-orange-100" data-key="mode2_desc">Challenge an opponent in a fast-paced quiz.</p>
                </div>
                <div onclick="showPage('build-lab-page')" class="bg-purple-500 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:bg-purple-600 transition">
                    <h2 class="text-xl font-bold" data-key="mode3_title">Build Your Own Lab (‡§Ü‡§™‡§≤‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≥‡§æ)</h2>
                    <p class="mt-1 text-purple-100" data-key="mode3_desc">Conduct virtual experiments hands-on.</p>
                </div>
                <div onclick="showPage('math-path-page')" class="bg-teal-500 text-white p-6 rounded-xl shadow-lg cursor-pointer hover:bg-teal-600 transition">
                    <h2 class="text-xl font-bold" data-key="mode4_title">Math Path (‡§ó‡§£‡§ø‡§§ ‡§™‡§•)</h2>
                    <p class="mt-1 text-teal-100" data-key="mode4_desc">Find the correct sequence to reach the target number.</p>
                </div>
            </div>
        </div>

        <div id="stem-village-page" class="p-6 hidden">
            <button onclick="showPage('student-home-page')" class="mb-4 text-blue-600 font-semibold" data-key="back_button">&larr; Back to Home</button>
            <h1 class="text-2xl font-bold text-center mb-4" data-key="mode1_title">STEM Village</h1>
            <div class="bg-green-100 p-4 rounded-lg"><svg id="village-map" viewBox="0 0 200 120" class="w-full h-auto"><rect width="200" height="120" fill="#a7f3d0" /><g id="physics-lab" class="opacity-30 cursor-pointer" onclick="startQuiz('physics')"><rect x="20" y="60" width="40" height="30" fill="#d1d5db" /><polygon points="18,60 62,60 40,40" fill="#9ca3af" /><text x="40" y="80" font-size="6" text-anchor="middle" fill="#374151" data-key="physics_lab">Physics Lab</text></g><g id="biology-farm" class="opacity-30 cursor-pointer" onclick="startQuiz('biology')"><rect x="80" y="70" width="40" height="20" fill="#fca5a5" /><rect x="85" y="60" width="30" height="10" fill="#ef4444" /><text x="100" y="83" font-size="6" text-anchor="middle" fill="#374151" data-key="biology_farm">Biology Farm</text></g><g id="chemistry-workshop" class="opacity-30 cursor-pointer" onclick="startQuiz('chemistry')"><rect x="140" y="50" width="40" height="40" fill="#a5b4fc" /><circle cx="160" cy="70" r="8" fill="#6366f1" /><text x="160" y="80" font-size="5" text-anchor="middle" fill="#374151" data-key="chemistry_workshop">Chemistry Shop</text></g></svg></div>
            <p class="text-center text-slate-500 mt-2" data-key="village_instructions">Click a grayed-out building to start a quiz and unlock it!</p>
            <div id="quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"><div class="bg-white p-6 rounded-lg shadow-xl w-11/12 max-w-md"><h2 id="quiz-title" class="text-xl font-bold mb-4"></h2><div id="quiz-question" class="text-lg mb-4"></div><div id="quiz-options" class="space-y-2"></div><p id="quiz-feedback" class="mt-4 font-bold text-center"></p></div></div>
        </div>
        <div id="knowledge-battle-page" class="p-6 hidden">
            <button onclick="showPage('student-home-page')" class="mb-4 text-blue-600 font-semibold" data-key="back_button">&larr; Back to Home</button>
            <h1 class="text-2xl font-bold text-center mb-4" data-key="mode2_title">Knowledge Battle</h1>
            <div id="battle-start-screen"><p class="text-center mb-4" data-key="battle_instructions">Get ready for a 3-question speed challenge!</p><button onclick="startBattle()" class="w-full bg-orange-500 text-white p-3 rounded-md font-bold" data-key="start_battle_button">Start Battle</button></div>
            <div id="battle-game-screen" class="hidden"><div class="text-center mb-4"><p class="text-sm text-slate-500" data-key="time_remaining">Time Remaining</p><p id="battle-timer" class="text-3xl font-bold">10</p></div><div class="flex justify-between items-center mb-4"><div class="text-center"><div class="w-16 h-16 bg-blue-200 rounded-full mx-auto flex items-center justify-center text-3xl">üßë‚Äçüéì</div><p class="font-bold" data-key="you">You</p><p id="player-score" class="text-xl font-bold">0</p></div><div class="font-bold text-2xl text-slate-400">VS</div><div class="text-center"><div class="w-16 h-16 bg-red-200 rounded-full mx-auto flex items-center justify-center text-3xl">ü§ñ</div><p class="font-bold" data-key="opponent">Opponent</p><p id="opponent-score" class="text-xl font-bold">0</p></div></div><div class="bg-slate-100 p-4 rounded-lg"><div id="battle-question" class="text-lg text-center font-semibold mb-4"></div><div id="battle-options" class="grid grid-cols-2 gap-2"></div></div><div id="battle-result" class="text-center mt-4 text-2xl font-bold"></div></div>
        </div>
        <div id="build-lab-page" class="p-6 hidden">
            <button onclick="showPage('student-home-page')" class="mb-4 text-blue-600 font-semibold" data-key="back_button">&larr; Back to Home</button>
            <h1 class="text-2xl font-bold text-center mb-4" data-key="mode3_title">Build Your Own Lab</h1>
            <div class="border p-4 rounded-lg"><h2 class="font-bold text-lg mb-2" data-key="lab_circuit_title">Experiment: Simple Circuit</h2><p id="circuit-feedback" class="text-center text-green-600 font-semibold mb-2 h-6"></p><div class="bg-slate-200 h-48 rounded-md flex justify-around items-center p-4 relative"><div id="battery-dropzone" class="w-16 h-16 border-2 border-dashed border-slate-400 rounded-md flex items-center justify-center text-slate-400" ondrop="drop(event)" ondragover="allowDrop(event)">Bat</div><div id="wire-dropzone" class="w-16 h-16 border-2 border-dashed border-slate-400 rounded-md flex items-center justify-center text-slate-400" ondrop="drop(event)" ondragover="allowDrop(event)">Wire</div><div id="bulb-dropzone" class="w-16 h-16 border-2 border-dashed border-slate-400 rounded-md flex items-center justify-center text-slate-400" ondrop="drop(event)" ondragover="allowDrop(event)">Bulb</div><div class="absolute inset-0 flex items-center justify-center pointer-events-none"><div id="circuit-bulb-visual" class="text-5xl bulb opacity-0 transition-opacity">üí°</div></div></div><div class="mt-4"><h3 class="font-semibold" data-key="toolbox">Toolbox</h3><div id="lab-toolbox" class="flex space-x-2 p-2 bg-slate-100 rounded-md mt-1 overflow-x-auto"><div id="battery" draggable="true" ondragstart="drag(event)" class="cursor-grab p-2 bg-yellow-300 rounded text-center flex-shrink-0">üîã<br><span class="text-xs" data-key="battery">Battery</span></div><div id="wire" draggable="true" ondragstart="drag(event)" class="cursor-grab p-2 bg-gray-300 rounded text-center flex-shrink-0">„Ä∞Ô∏è<br><span class="text-xs" data-key="wire">Wire</span></div><div id="bulb" draggable="true" ondragstart="drag(event)" class="cursor-grab p-2 bg-blue-300 rounded text-center flex-shrink-0">üí°<br><span class="text-xs" data-key="bulb">Bulb</span></div></div><button onclick="resetCircuit()" class="mt-2 text-sm text-red-500" data-key="reset_button">Reset</button></div></div>
        </div>

        <div id="math-path-page" class="p-6 hidden">
            <button id="math-path-back-btn" onclick="showPage('student-home-page')" class="mb-4 text-blue-600 font-semibold" data-key="back_button">&larr; Back to Home</button>
            <h1 class="text-2xl font-bold text-center mb-4" data-key="mode4_title">Math Path</h1>
            <div id="math-path-level-select">
                <p class="text-center text-slate-600 mb-4" data-key="math_path_select_level">Select a level to begin!</p>
                <div id="math-path-levels-container" class="grid grid-cols-3 gap-4">
                    </div>
            </div>
            <div id="math-path-game-screen" class="hidden">
                <div class="flex justify-between items-center bg-slate-100 p-3 rounded-lg mb-4">
                    <div>
                        <p class="text-sm font-bold text-slate-700" data-key="target">TARGET</p>
                        <p id="math-path-target" class="text-2xl font-bold text-green-600"></p>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-slate-700" data-key="current_total">CURRENT</p>
                        <p id="math-path-current" class="text-2xl font-bold text-blue-600"></p>
                    </div>
                </div>
                <div id="math-path-environment" class="relative h-96 rounded-lg p-4 overflow-hidden transition-colors duration-500">
                    <div id="math-path-stones-container" class="relative w-full h-full">
                        </div>
                    <div id="math-path-player" class="absolute text-4xl transition-all duration-500 ease-in-out" style="transform: translate(-50%, -50%);">
                        üö∂
                    </div>
                </div>
                <p id="math-path-feedback" class="text-center font-bold mt-4 h-6"></p>
            </div>
        </div>

        <div id="teacher-dashboard-page" class="p-6 hidden">
            <header class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800" data-key="teacher_dashboard_title">Teacher Dashboard</h1>
                    <p class="text-slate-500" data-key="class_overview_full">Full Class Overview</p>
                </div>
                <button onclick="logout()" class="text-sm text-red-500 font-semibold flex-shrink-0" data-key="logout_button">Logout</button>
            </header>
            <div class="mb-6 flex justify-center space-x-2">
                <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="en">English</button>
                <button onclick="setLanguage('hi')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                <button onclick="setLanguage('mr')" class="lang-btn px-3 py-1 text-sm rounded-full bg-slate-200" data-lang="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
            </div>
            <div class="mb-8 p-4 border rounded-lg">
                <h2 class="text-xl font-bold text-slate-700 mb-4" data-key="class_analytics">Class Analytics</h2>
                <div class="mb-6">
                    <h3 class="font-bold text-lg mb-2" data-key="mode_engagement">Mode Engagement</h3>
                    <canvas id="mode-engagement-chart"></canvas>
                </div>
                <div class="mb-6">
                    <h3 class="font-bold text-lg mb-2" data-key="quiz_scores">Average Quiz Scores</h3>
                    <canvas id="quiz-scores-chart"></canvas>
                </div>
                <div>
                     <h3 class="font-bold text-lg mb-2" data-key="leaderboard">Leaderboard</h3>
                     <table class="w-full text-sm text-left text-slate-500">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th scope="col" class="px-6 py-3" data-key="rank">Rank</th>
                                <th scope="col" class="px-6 py-3" data-key="student">Student</th>
                                <th scope="col" class="px-6 py-3" data-key="score">Score</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body"></tbody>
                    </table>
                </div>
            </div>
            <div>
                <h2 class="text-xl font-bold text-slate-700 mb-4" data-key="individual_progress">Individual Student Progress</h2>
                <div id="student-progress-container" class="space-y-4"></div>
            </div>
            <div class="mt-8">
                 <h2 class="font-bold text-lg mb-2" data-key="data_export">Data Export</h2>
                 <button onclick="exportData()" class="w-full bg-gray-700 text-white p-3 rounded-md font-bold hover:bg-gray-800" data-key="export_csv_button">Export All Data as CSV</button>
            </div>
        </div>
    </div>

    <script>
    // ===================================================================
    // 0. App State & Translations
    // ===================================================================
    let currentPage = 'login-page';
    let currentLanguage = 'en';
    let studentData = {
        standard: null,
        village: { 'physics-lab': false, 'biology-farm': false, 'chemistry-workshop': false },
        lab: { circuitComplete: false, components: { battery: false, wire: false, bulb: false } },
        mathPathLevel: 0
    };

    const translations = {
        en: {
            app_title: "STEM Spark", app_subtitle: "Your Journey into Science & Tech", student_login_title: "Student Login", teacher_login_title: "Teacher Login",
            placeholder_school_code: "School/Institution Code", placeholder_student_id: "Student ID/Username", placeholder_email: "Email/Username",
            placeholder_password: "Password", login_button: "Login", welcome: "Welcome, Student!", home_subtitle: "Choose your adventure", logout_button: "Logout",
            mode1_title: "STEM Village Simulator", mode1_desc: "Build a village by mastering STEM concepts.", mode2_title: "Knowledge Battle (‡§ú‡•ç‡§û‡§æ‡§® ‡§Ø‡•Å‡§¶‡•ç‡§ß)",
            mode2_desc: "Challenge an opponent in a fast-paced quiz.", mode3_title: "Build Your Own Lab (‡§Ü‡§™‡§≤‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≥‡§æ)", mode3_desc: "Conduct virtual experiments hands-on.",
            mode4_title: "Math Path (‡§ó‡§£‡§ø‡§§ ‡§™‡§•)", mode4_desc: "Find the correct sequence to reach the target number.",
            back_button: "‚Üê Back to Home", village_instructions: "Click a grayed-out building to start a quiz and unlock it!", physics_lab: "Physics Lab", biology_farm: "Biology Farm",
            chemistry_workshop: "Chemistry Workshop", battle_instructions: "Get ready for a 3-question speed challenge!", start_battle_button: "Start Battle",
            time_remaining: "Time Remaining", you: "You", opponent: "Opponent", lab_circuit_title: "Experiment: Simple Circuit", toolbox: "Toolbox",
            battery: "Battery", wire: "Wire", bulb: "Bulb", reset_button: "Reset", teacher_dashboard_title: "Teacher Dashboard", class_overview_full: "Full Class Overview",
            class_analytics: "Class Analytics", individual_progress: "Individual Student Progress", mode_engagement: "Mode Engagement",
            quiz_scores: "Average Quiz Scores", leaderboard: "Leaderboard", rank: "Rank", student: "Student", score: "Score", data_export: "Data Export",
            export_csv_button: "Export All Data as CSV", standard_6: "Standard 6", standard_7: "Standard 7", standard_8: "Standard 8", standard_9: "Standard 9",
            standard_10: "Standard 10", standard_11: "Standard 11", standard_12: "Standard 12", math_path_select_level: "Select a level to begin!",
            target: "TARGET", current_total: "CURRENT", level_complete: "Level Complete! üéâ", wrong_step: "Wrong step! Try again.",
            badge_unlocked: "Badge Unlocked!", algebra_explorer: "Algebra Explorer", trig_pathfinder: "Trig Pathfinder"
        },
        hi: {
            app_title: "‡§∏‡•ç‡§ü‡•á‡§Æ ‡§∏‡•ç‡§™‡§æ‡§∞‡•ç‡§ï", app_subtitle: "‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§î‡§∞ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ", student_login_title: "‡§õ‡§æ‡§§‡•ç‡§∞ ‡§≤‡•â‡§ó‡§ø‡§®", teacher_login_title: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§≤‡•â‡§ó‡§ø‡§®",
            placeholder_school_code: "‡§∏‡•ç‡§ï‡•Ç‡§≤/‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•ã‡§°", placeholder_student_id: "‡§õ‡§æ‡§§‡•ç‡§∞ ‡§Ü‡§à‡§°‡•Ä/‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ", placeholder_email: "‡§à‡§Æ‡•á‡§≤/‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ",
            placeholder_password: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°", login_button: "‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç", welcome: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, ‡§õ‡§æ‡§§‡•ç‡§∞!", home_subtitle: "‡§Ö‡§™‡§®‡§æ ‡§∏‡§æ‡§π‡§∏‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç", logout_button: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü",
            mode1_title: "‡§∏‡•ç‡§ü‡•á‡§Æ ‡§µ‡§ø‡§≤‡•á‡§ú ‡§∏‡§ø‡§Æ‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞", mode1_desc: "‡§∏‡•ç‡§ü‡•á‡§Æ ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§π‡§æ‡§∞‡§§ ‡§π‡§æ‡§∏‡§ø‡§≤ ‡§ï‡§∞‡§ï‡•á ‡§è‡§ï ‡§ó‡§æ‡§Å‡§µ ‡§¨‡§®‡§æ‡§è‡§Å‡•§", mode2_title: "‡§ú‡•ç‡§û‡§æ‡§® ‡§Ø‡•Å‡§¶‡•ç‡§ß", mode2_desc: "‡§è‡§ï ‡§§‡•á‡§ú‡§º ‡§ó‡§§‡§ø ‡§µ‡§æ‡§≤‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§§‡§ø‡§¶‡•ç‡§µ‡§Ç‡§¶‡•ç‡§µ‡•Ä ‡§ï‡•ã ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§¶‡•á‡§Ç‡•§",
            mode3_title: "‡§Ö‡§™‡§®‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ ‡§¨‡§®‡§æ‡§è‡§Å (‡§Ü‡§™‡§≤‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≥‡§æ)", mode3_desc: "‡§Ü‡§≠‡§æ‡§∏‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§® ‡§ï‡§∞‡•á‡§Ç‡•§", mode4_title: "‡§ó‡§£‡§ø‡§§ ‡§™‡§•", mode4_desc: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§ñ‡•ã‡§ú‡•á‡§Ç‡•§",
            back_button: "‚Üê ‡§π‡•ã‡§Æ ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏", village_instructions: "‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§â‡§∏‡•á ‡§Ö‡§®‡§≤‡•â‡§ï ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§ß‡•Ç‡§∏‡§∞ ‡§á‡§Æ‡§æ‡§∞‡§§ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç!", physics_lab: "‡§≠‡•å‡§§‡§ø‡§ï‡•Ä ‡§≤‡•à‡§¨",
            biology_farm: "‡§ú‡•Ä‡§µ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§´‡§æ‡§∞‡•ç‡§Æ", chemistry_workshop: "‡§∞‡§∏‡§æ‡§Ø‡§® ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§∂‡§æ‡§≤‡§æ", battle_instructions: "3-‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§ó‡§§‡§ø ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§á‡§è!",
            start_battle_button: "‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", time_remaining: "‡§∂‡•á‡§∑ ‡§∏‡§Æ‡§Ø", you: "‡§Ü‡§™", opponent: "‡§™‡•ç‡§∞‡§§‡§ø‡§¶‡•ç‡§µ‡§Ç‡§¶‡•ç‡§µ‡•Ä", lab_circuit_title: "‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó: ‡§∏‡§∞‡§≤ ‡§∏‡§∞‡•ç‡§ï‡§ø‡§ü",
            toolbox: "‡§ü‡•Ç‡§≤‡§¨‡•â‡§ï‡•ç‡§∏", battery: "‡§¨‡•à‡§ü‡§∞‡•Ä", wire: "‡§§‡§æ‡§∞", bulb: "‡§¨‡§≤‡•ç‡§¨", reset_button: "‡§∞‡•Ä‡§∏‡•á‡§ü", teacher_dashboard_title: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°",
            class_overview_full: "‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§ï‡•ç‡§∑‡§æ ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®", class_analytics: "‡§ï‡§ï‡•ç‡§∑‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£", individual_progress: "‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§™‡•ç‡§∞‡§ó‡§§‡§ø", mode_engagement: "‡§Æ‡•ã‡§° ‡§∏‡§π‡§≠‡§æ‡§ó‡§ø‡§§‡§æ",
            quiz_scores: "‡§î‡§∏‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä ‡§∏‡•ç‡§ï‡•ã‡§∞", leaderboard: "‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§°", rank: "‡§∞‡•à‡§Ç‡§ï", student: "‡§õ‡§æ‡§§‡•ç‡§∞", score: "‡§∏‡•ç‡§ï‡•ã‡§∞", data_export: "‡§°‡•á‡§ü‡§æ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§",
            export_csv_button: "‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã CSV ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç", standard_6: "‡§ï‡§ï‡•ç‡§∑‡§æ 6", standard_7: "‡§ï‡§ï‡•ç‡§∑‡§æ 7", standard_8: "‡§ï‡§ï‡•ç‡§∑‡§æ 8", standard_9: "‡§ï‡§ï‡•ç‡§∑‡§æ 9",
            standard_10: "‡§ï‡§ï‡•ç‡§∑‡§æ 10", standard_11: "‡§ï‡§ï‡•ç‡§∑‡§æ 11", standard_12: "‡§ï‡§ï‡•ç‡§∑‡§æ 12", math_path_select_level: "‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§∏‡•ç‡§§‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç!", target: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø",
            current_total: "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§®", level_complete: "‡§∏‡•ç‡§§‡§∞ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü! üéâ", wrong_step: "‡§ó‡§≤‡§§ ‡§ï‡§¶‡§Æ! ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç„ÄÇ", badge_unlocked: "‡§¨‡•à‡§ú ‡§Ö‡§®‡§≤‡•â‡§ï!", algebra_explorer: "‡§¨‡•Ä‡§ú‡§ó‡§£‡§ø‡§§ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•ã‡§∞‡§∞", trig_pathfinder: "‡§ü‡•ç‡§∞‡§ø‡§ó ‡§™‡§æ‡§•‡§´‡§æ‡§á‡§Ç‡§°‡§∞"
        },
        mr: {
            app_title: "‡§∏‡•ç‡§ü‡•á‡§Æ ‡§∏‡•ç‡§™‡§æ‡§∞‡•ç‡§ï", app_subtitle: "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§Ü‡§£‡§ø ‡§§‡§Ç‡§§‡•ç‡§∞‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§µ‡§æ‡§∏", student_login_title: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§≤‡•â‡§ó‡§ø‡§®", teacher_login_title: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§≤‡•â‡§ó‡§ø‡§®",
            placeholder_school_code: "‡§∂‡§æ‡§≥‡§æ/‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§ï‡•ã‡§°", placeholder_student_id: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§Ü‡§Ø‡§°‡•Ä/‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ‡§®‡§æ‡§µ", placeholder_email: "‡§à‡§Æ‡•á‡§≤/‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ‡§®‡§æ‡§µ",
            placeholder_password: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°", login_button: "‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡§æ", welcome: "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á, ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä!", home_subtitle: "‡§§‡•Å‡§Æ‡§ö‡•á ‡§∏‡§æ‡§π‡§∏ ‡§®‡§ø‡§µ‡§°‡§æ", logout_button: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü",
            mode1_title: "‡§∏‡•ç‡§ü‡•á‡§Æ ‡§µ‡•ç‡§π‡§ø‡§≤‡•á‡§ú ‡§∏‡§ø‡§Æ‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞", mode1_desc: "STEM ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™‡§®‡§æ‡§Ç‡§µ‡§∞ ‡§™‡•ç‡§∞‡§≠‡•Å‡§§‡•ç‡§µ ‡§Æ‡§ø‡§≥‡§µ‡•Ç‡§® ‡§è‡§ï ‡§ó‡§æ‡§µ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ.", mode2_title: "‡§ú‡•ç‡§û‡§æ‡§® ‡§Ø‡•Å‡§¶‡•ç‡§ß",
            mode2_desc: "‡§ú‡§≤‡§¶ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡§Æ‡§Ç‡§ú‡•Å‡§∑‡§æ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡•ç‡§™‡§∞‡•ç‡§ß‡•ç‡§Ø‡§æ‡§≤‡§æ ‡§Ü‡§µ‡•ç‡§π‡§æ‡§® ‡§¶‡•ç‡§Ø‡§æ.", mode3_title: "‡§Ü‡§™‡§≤‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≥‡§æ", mode3_desc: "‡§Ü‡§≠‡§æ‡§∏‡•Ä ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§∏‡•ç‡§µ‡§§‡§É ‡§ï‡§∞‡§æ.",
            mode4_title: "‡§ó‡§£‡§ø‡§§ ‡§™‡§•", mode4_desc: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï‡§æ‡§µ‡§∞ ‡§™‡•ã‡§π‡•ã‡§ö‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§ï‡•ç‡§∞‡§Æ ‡§∂‡•ã‡§ß‡§æ.", back_button: "‚Üê ‡§π‡•ã‡§Æ‡§µ‡§∞ ‡§™‡§∞‡§§ ‡§ú‡§æ",
            village_instructions: "‡§ï‡•ç‡§µ‡§ø‡§ù ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§£‡§ø ‡§§‡•á ‡§Ö‡§®‡§≤‡•â‡§ï ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§∞‡§æ‡§ñ‡§æ‡§°‡•Ä ‡§á‡§Æ‡§æ‡§∞‡§§‡•Ä‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ!", physics_lab: "‡§≠‡•å‡§§‡§ø‡§ï‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§≤‡•Ö‡§¨", biology_farm: "‡§ú‡•Ä‡§µ‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§´‡§æ‡§∞‡•ç‡§Æ",
            chemistry_workshop: "‡§∞‡§∏‡§æ‡§Ø‡§®‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§∂‡§æ‡§≥‡§æ", battle_instructions: "3-‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§µ‡•á‡§ó‡§µ‡§æ‡§® ‡§Ü‡§µ‡•ç‡§π‡§æ‡§®‡§æ‡§∏‡§æ‡§†‡•Ä ‡§∏‡§ú‡•ç‡§ú ‡§µ‡•ç‡§π‡§æ!", start_battle_button: "‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
            time_remaining: "‡§â‡§∞‡§≤‡•á‡§≤‡§æ ‡§µ‡•á‡§≥", you: "‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä", opponent: "‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡•ç‡§™‡§∞‡•ç‡§ß‡•Ä", lab_circuit_title: "‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó: ‡§∏‡§æ‡§ß‡•á ‡§∏‡§∞‡•ç‡§ï‡§ø‡§ü", toolbox: "‡§ü‡•Ç‡§≤‡§¨‡•â‡§ï‡•ç‡§∏", battery: "‡§¨‡•Ö‡§ü‡§∞‡•Ä",
            wire: "‡§§‡§æ‡§∞", bulb: "‡§¨‡§≤‡•ç‡§¨", reset_button: "‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ", teacher_dashboard_title: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°", class_overview_full: "‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡§∞‡•ç‡§ó ‡§Ü‡§¢‡§æ‡§µ‡§æ",
            class_analytics: "‡§µ‡§∞‡•ç‡§ó ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£", individual_progress: "‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡•Ä", mode_engagement: "‡§Æ‡•ã‡§° ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§¶‡•ç‡§ß‡§§‡§æ", quiz_scores: "‡§∏‡§∞‡§æ‡§∏‡§∞‡•Ä ‡§ï‡•ç‡§µ‡§ø‡§ù ‡§ó‡•Å‡§£",
            leaderboard: "‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§°", rank: "‡§∞‡§Å‡§ï", student: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä", score: "‡§ó‡•Å‡§£", data_export: "‡§°‡•á‡§ü‡§æ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§", export_csv_button: "‡§∏‡§∞‡•ç‡§µ ‡§°‡•á‡§ü‡§æ CSV ‡§Æ‡•ç‡§π‡§£‡•Ç‡§® ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡§æ",
            standard_6: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•¨ ‡§µ‡•Ä", standard_7: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•≠ ‡§µ‡•Ä", standard_8: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•Æ ‡§µ‡•Ä", standard_9: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•Ø ‡§µ‡•Ä", standard_10: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•ß‡•¶ ‡§µ‡•Ä",
            standard_11: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•ß‡•ß ‡§µ‡•Ä", standard_12: "‡§á‡§Ø‡§§‡•ç‡§§‡§æ ‡•ß‡•® ‡§µ‡•Ä", math_path_select_level: "‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§è‡§ï ‡§∏‡•ç‡§§‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ!", target: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø", current_total: "‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•á",
            level_complete: "‡§∏‡•ç‡§§‡§∞ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ù‡§æ‡§≤‡§æ! üéâ", wrong_step: "‡§ö‡•Å‡§ï‡•Ä‡§ö‡•á ‡§™‡§æ‡§ä‡§≤! ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ„ÄÇ", badge_unlocked: "‡§¨‡•Ö‡§ú ‡§Ö‡§®‡§≤‡•â‡§ï ‡§ï‡•á‡§≤‡•á!", algebra_explorer: "‡§Ö‡§≤‡•ç‡§ú‡•á‡§¨‡•ç‡§∞‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§≤‡•ã‡§∞‡§∞", trig_pathfinder: "‡§ü‡•ç‡§∞‡§ø‡§ó ‡§™‡§æ‡§•‡§´‡§æ‡§á‡§Ç‡§°‡§∞"
        }
    };

    // ===================================================================
    // 1. Core App Functions
    // ===================================================================
    document.addEventListener('DOMContentLoaded', () => {
        setLanguage(currentLanguage);
        document.getElementById('student-login-form').addEventListener('submit', handleStudentLogin);
        document.getElementById('teacher-login-form').addEventListener('submit', handleTeacherLogin);
        initializeMathPathLevels();
    });

    function showPage(pageId) {
        document.getElementById(currentPage).classList.add('hidden');
        document.getElementById(pageId).classList.remove('hidden');
        currentPage = pageId;
        window.scrollTo(0, 0);
    }

    function setLanguage(lang) {
        currentLanguage = lang;
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (translations[lang][key]) el.innerText = translations[lang][key];
        });
        document.querySelectorAll('[data-key-placeholder]').forEach(el => {
            const key = el.getAttribute('data-key-placeholder');
            if (translations[lang][key]) el.placeholder = translations[lang][key];
        });
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('bg-blue-500', btn.getAttribute('data-lang') === lang);
            btn.classList.toggle('text-white', btn.getAttribute('data-lang') === lang);
            btn.classList.toggle('bg-slate-200', btn.getAttribute('data-lang') !== lang);
        });
    }

    function logout() {
        showPage('login-page');
    }

    // ===================================================================
    // 2. Authentication Logic
    // ===================================================================
    function handleStudentLogin(event) {
        event.preventDefault();
        const schoolCode = document.getElementById('school-code').value;
        const studentId = document.getElementById('student-id').value;
        const password = document.getElementById('student-password').value;
        const errorEl = document.getElementById('login-error');

        if (schoolCode === 'SCH01' && studentId === 'stud1' && password === 'pass1') {
            studentData.standard = document.getElementById('student-standard').value;
            errorEl.classList.add('hidden');
            setLanguage(currentLanguage);
            showPage('student-home-page');
        } else {
            errorEl.innerText = "Invalid credentials. Please try again.";
            errorEl.classList.remove('hidden');
        }
    }

    function handleTeacherLogin(event) {
        event.preventDefault();
        const email = document.getElementById('teacher-email').value;
        const password = document.getElementById('teacher-password').value;
        const errorEl = document.getElementById('login-error');

        if (email === 'teacher@school.com' && password === 'password') {
            errorEl.classList.add('hidden');
            setLanguage(currentLanguage);
            renderTeacherDashboard();
            showPage('teacher-dashboard-page');
        } else {
            errorEl.innerText = "Invalid credentials. Please try again.";
            errorEl.classList.remove('hidden');
        }
    }

    // ===================================================================
    // 3, 4, 5. Existing Game Logic (STEM Village, Battle, Lab)
    // ===================================================================
    const quizzes={physics:[{q:"What is the unit of electric current?",o:["Volt","Watt","Ampere","Ohm"],a:"Ampere"},{q:"Which of these is a renewable energy source?",o:["Coal","Solar","Natural Gas","Petrol"],a:"Solar"}],biology:[{q:"What is the process by which plants make their food?",o:["Respiration","Photosynthesis","Transpiration","Germination"],a:"Photosynthesis"},{q:"The 'powerhouse' of the cell is the...?",o:["Nucleus","Ribosome","Mitochondrion","Cell Wall"],a:"Mitochondrion"}],chemistry:[{q:"What is the chemical symbol for water?",o:["H2O","CO2","O2","NaCl"],a:"H2O"},{q:"Which gas do we breathe out?",o:["Oxygen","Nitrogen","Carbon Dioxide","Hydrogen"],a:"Carbon Dioxide"}]};let currentQuizTopic="",currentQuestionIndex=0,score=0;function startQuiz(a){const b="biology"===a?"biology-farm":"chemistry"===a?"chemistry-workshop":"physics-lab";if(studentData.village[b])return void alert("You have already unlocked this!");currentQuizTopic=a,currentQuestionIndex=0,score=0,document.getElementById("quiz-modal").classList.remove("hidden"),document.getElementById("quiz-feedback").innerText="",loadQuizQuestion()}function loadQuizQuestion(){const a=quizzes[currentQuizTopic][currentQuestionIndex];document.getElementById("quiz-title").innerText=`Question ${currentQuestionIndex+1} of ${quizzes[currentQuizTopic].length}`,document.getElementById("quiz-question").innerText=a.q;const b=document.getElementById("quiz-options");b.innerHTML="",a.o.forEach(c=>{const d=document.createElement("button");d.innerText=c,d.className="w-full p-3 text-left border rounded-md hover:bg-slate-100",d.onclick=()=>selectAnswer(c,a.a),b.appendChild(d)})}function selectAnswer(a,b){const c=document.getElementById("quiz-feedback");c.classList.remove("feedback-animation"),void c.offsetWidth,a===b?(score++,c.innerText="Correct! ‚úÖ",c.className="mt-4 font-bold text-center text-green-500 feedback-animation"):(c.innerText="Incorrect! ‚ùå",c.className="mt-4 font-bold text-center text-red-500 feedback-animation"),setTimeout(()=>{currentQuestionIndex++,currentQuestionIndex<quizzes[currentQuizTopic].length?(loadQuizQuestion(),c.innerText=""):finishQuiz()},1200)}function finishQuiz(){const a=document.getElementById("quiz-modal");score>=1?(alert(`Quiz complete! You scored ${score}/${quizzes[currentQuizTopic].length}. You earned a blueprint!`),"biology"==currentQuizTopic?partId="biology-farm":"chemistry"==currentQuizTopic?partId="chemistry-workshop":partId=`${currentQuizTopic}-lab`,studentData.village[partId]=!0,document.getElementById(partId).classList.remove("opacity-30")):alert(`Quiz complete. You scored ${score}/${quizzes[currentQuizTopic].length}. Try again!`),a.classList.add("hidden")}let battleInterval,battlePlayerScore=0,battleOpponentScore=0,battleQuestionNum=0;const battleQuestions=[{q:"What planet is known as the Red Planet?",o:["Earth","Mars","Jupiter","Venus"],a:"Mars"},{q:"What is the boiling point of water in Celsius?",o:["90¬∞C","100¬∞C","120¬∞C","50¬∞C"],a:"100¬∞C"},{q:"How many bones are in the adult human body?",o:["206","180","256","300"],a:"206"}];function startBattle(){document.getElementById("battle-start-screen").classList.add("hidden"),document.getElementById("battle-game-screen").classList.remove("hidden"),battlePlayerScore=0,battleOpponentScore=0,battleQuestionNum=0,document.getElementById("player-score").innerText=0,document.getElementById("opponent-score").innerText=0,document.getElementById("battle-result").innerText="",loadBattleQuestion()}
    function loadBattleQuestion(){if(battleQuestionNum>=battleQuestions.length)return void endBattle();let a=10;const b=document.getElementById("battle-timer");b.innerText=a;const c=battleQuestions[battleQuestionNum];document.getElementById("battle-question").innerText=c.q;const d=document.getElementById("battle-options");d.innerHTML="",c.o.forEach(e=>{const f=document.createElement("button");f.innerText=e,f.className="w-full p-3 bg-white border rounded-md hover:bg-slate-100",f.onclick=()=>selectBattleAnswer(e,c.a,a,f),d.appendChild(f)}),battleInterval=setInterval(()=>{a--,b.innerText=a,a<=0&&(clearInterval(battleInterval),battleQuestionNum++,loadBattleQuestion()),a===Math.floor(5*Math.random())+2&&(battleOpponentScore+=5,document.getElementById("opponent-score").innerText=battleOpponentScore)},1e3)}function selectBattleAnswer(a,b,c,d){clearInterval(battleInterval),document.querySelectorAll("#battle-options button").forEach(a=>a.disabled=!0),a===b?(battlePlayerScore+=c,document.getElementById("player-score").innerText=battlePlayerScore,d.classList.add("bg-green-300","border-green-500")):d.classList.add("bg-red-300","border-red-500"),setTimeout(()=>{battleQuestionNum++,loadBattleQuestion()},1e3)}
    function endBattle(){clearInterval(battleInterval),document.getElementById("battle-question").innerText="Battle Over!",document.getElementById("battle-options").innerHTML="";const a=document.getElementById("battle-result");battlePlayerScore>battleOpponentScore?(a.innerText="You Win! üéâ",a.className="text-center mt-4 text-2xl font-bold text-green-500"):battleOpponentScore>battlePlayerScore?(a.innerText="You Lose! üòû",a.className="text-center mt-4 text-2xl font-bold text-red-500"):(a.innerText="It's a Draw! ü§ù",a.className="text-center mt-4 text-2xl font-bold text-slate-500"),setTimeout(()=>{document.getElementById("battle-start-screen").classList.remove("hidden"),document.getElementById("battle-game-screen").classList.add("hidden")},3e3)}function allowDrop(a){a.preventDefault()}function drag(a){a.dataTransfer.setData("text",a.target.id)}function drop(a){a.preventDefault();const b=a.dataTransfer.getData("text"),c=a.target.id;c.includes(b)&&(a.target.innerHTML="",a.target.appendChild(document.getElementById(b).cloneNode(!0)),studentData.lab.components[b]=!0,checkCircuit())}
    function checkCircuit(){const{battery:a,wire:b,bulb:c}=studentData.lab.components;a&&b&&c&&(studentData.lab.circuitComplete=!0,document.getElementById("circuit-bulb-visual").classList.add("on","opacity-100"),document.getElementById("circuit-feedback").innerText="Circuit Complete! The bulb lights up.")}function resetCircuit(){studentData.lab.circuitComplete=!1,studentData.lab.components={battery:!1,wire:!1,bulb:!1},document.getElementById("battery-dropzone").innerHTML="Bat",document.getElementById("wire-dropzone").innerHTML="Wire",document.getElementById("bulb-dropzone").innerHTML="Bulb",document.getElementById("circuit-bulb-visual").classList.remove("on","opacity-100"),document.getElementById("circuit-feedback").innerText=""}

    // ===================================================================
    // 6. Math Path Game Logic
    // ===================================================================
    const mathPathLevels = [
        { level: 1, gradeRange: "6-7", theme: "river", target: 20, startValue: 0,
          path: [ { display: "√ó 2", operation: c => c * 2, pos: { top: "35%", left: "55%" } },
                  { display: "+ 10", operation: c => c + 10, pos: { top: "15%", left: "20%" } },
                  { display: "√∑ 3", operation: c => c / 3, pos: { top: "55%", left: "30%" } },
                  { display: "√ó 4", operation: c => c * 4, pos: { top: "75%", left: "60%" } } ],
          correctSequence: [1, 0, 3]
        },
        { level: 2, gradeRange: "8-9", theme: "schoolyard", target: 12, startValue: 0, badge: "algebra_explorer",
          path: [ { display: "x = 4", operation: c => c, pos: { top: "8%", left: "5%" } },
                  { display: "2x + 4", operation: c => 2 * 4 + 4, pos: { top: "25%", left: "40%" } },
                  { display: "- 2", operation: c => c - 2, pos: { top: "50%", left: "15%" } },
                  { display: "√∑ 2", operation: c => c / 2, pos: { top: "70%", left: "65%" } } ],
          correctSequence: [1, 2]
        },
        { level: 3, gradeRange: "10", theme: "sky", target: 16, startValue: 0,
          path: [ { display: "‚àö4", operation: c => Math.sqrt(4), pos: { top: "15%", left: "60%" } },
                  { display: "√ó 8", operation: c => c * 8, pos: { top: "40%", left: "25%" } },
                  { display: "+ 4", operation: c => c + 4, pos: { top: "65%", left: "50%" } },
                  { display: "2¬≤", operation: c => Math.pow(2, 2), pos: { top: "25%", left: "10%" } } ],
          correctSequence: [0, 1]
        },
        { level: 4, gradeRange: "11-12", theme: "neon", target: 1, startValue: 0, badge: "trig_pathfinder",
          path: [ { display: "sin(30¬∞)", operation: c => Math.sin(30 * Math.PI / 180), pos: { top: "10%", left: "20%" } },
                  { display: "+ cos(60¬∞)", operation: c => c + Math.cos(60 * Math.PI / 180), pos: { top: "40%", left: "60%" } },
                  { display: "√ó tan(45¬∞)", operation: c => c * Math.tan(45 * Math.PI / 180), pos: { top: "70%", left: "30%" } } ],
          correctSequence: [0, 1]
        }
    ];
    let currentMathLevelData, currentTotal, currentCorrectStep;

    function initializeMathPathLevels() {
        const container = document.getElementById('math-path-levels-container');
        container.innerHTML = '';
        mathPathLevels.forEach(level => {
            const button = document.createElement('button');
            button.className = 'p-4 bg-teal-500 text-white font-bold rounded-lg shadow hover:bg-teal-600';
            button.innerText = `Level ${level.level}\n(Gr. ${level.gradeRange})`;
            button.onclick = () => startMathPathLevel(level.level);
            container.appendChild(button);
        });
    }

    function startMathPathLevel(levelNum) {
        document.getElementById('math-path-level-select').classList.add('hidden');
        document.getElementById('math-path-game-screen').classList.remove('hidden');
        document.getElementById('math-path-back-btn').onclick = () => {
             document.getElementById('math-path-level-select').classList.remove('hidden');
             document.getElementById('math-path-game-screen').classList.add('hidden');
             document.getElementById('math-path-back-btn').onclick = () => showPage('student-home-page');
        };

        currentMathLevelData = mathPathLevels.find(l => l.level === levelNum);
        currentTotal = currentMathLevelData.startValue;
        currentCorrectStep = 0;

        document.getElementById('math-path-target').innerText = currentMathLevelData.target;
        document.getElementById('math-path-current').innerText = currentTotal;
        document.getElementById('math-path-feedback').innerText = '';

        renderMathPathStones();
        movePlayer(null); // Move to start position
        
        const environment = document.getElementById('math-path-environment');
        environment.className = "relative h-96 rounded-lg p-4 overflow-hidden transition-colors duration-500"; // Reset classes
        const theme = currentMathLevelData.theme;
        if (theme === 'river') environment.classList.add('bg-blue-400');
        else if (theme === 'schoolyard') environment.classList.add('bg-green-500');
        else if (theme === 'sky') environment.classList.add('bg-gray-900');
        else if (theme === 'neon') environment.classList.add('bg-black');
        else environment.classList.add('bg-slate-200');
    }

    function renderMathPathStones() {
        const container = document.getElementById('math-path-stones-container');
        container.innerHTML = '';
        currentMathLevelData.path.forEach((stone, index) => {
            const stoneEl = document.createElement('button');
            stoneEl.id = `stone-${index}`;
            stoneEl.className = 'absolute w-20 h-20 border-4 rounded-full flex items-center justify-center font-bold text-slate-700 shadow-lg transform hover:scale-110 transition-transform';
            if (currentMathLevelData.theme === 'neon') {
                stoneEl.classList.add('stone-neon');
            } else {
                stoneEl.classList.add('bg-yellow-200', 'border-yellow-300');
            }
            stoneEl.innerText = stone.display;
            stoneEl.style.top = stone.pos.top;
            stoneEl.style.left = stone.pos.left;
            stoneEl.onclick = () => handleStoneClick(index);
            container.appendChild(stoneEl);
        });
    }

    function handleStoneClick(stoneIndex) {
        const player = document.getElementById('math-path-player');
        const feedback = document.getElementById('math-path-feedback');
        player.classList.remove('shake-animation');

        // Check if the clicked stone is the correct one IN THE SEQUENCE
        if (stoneIndex !== currentMathLevelData.correctSequence[currentCorrectStep]) {
            feedback.innerText = translations[currentLanguage].wrong_step;
            feedback.className = 'text-center font-bold mt-4 h-6 text-red-500 feedback-animation';
            player.classList.add('shake-animation');
            setTimeout(() => startMathPathLevel(currentMathLevelData.level), 1500);
            return;
        }

        const stoneData = currentMathLevelData.path[stoneIndex];
        currentTotal = stoneData.operation(currentTotal);
        document.getElementById('math-path-current').innerText = Math.round(currentTotal * 100) / 100; // Round to 2 decimal places for fractions/trig
        feedback.innerText = '';
        
        movePlayer(document.getElementById(`stone-${stoneIndex}`));
        currentCorrectStep++;

        // Check for win condition
        const totalSteps = currentMathLevelData.correctSequence.length;
        if (currentCorrectStep === totalSteps) {
            if (currentTotal === currentMathLevelData.target) {
                feedback.innerText = translations[currentLanguage].level_complete;
                feedback.className = 'text-center font-bold mt-4 h-6 text-green-500 feedback-animation';
                if (currentMathLevelData.level > studentData.mathPathLevel) {
                    studentData.mathPathLevel = currentMathLevelData.level;
                }
                if (currentMathLevelData.badge) {
                    unlockBadge(currentMathLevelData.badge);
                }
                setTimeout(() => {
                    document.getElementById('math-path-level-select').classList.remove('hidden');
                    document.getElementById('math-path-game-screen').classList.add('hidden');
                }, 2000);
            } else {
                 feedback.innerText = translations[currentLanguage].wrong_step;
                 feedback.className = 'text-center font-bold mt-4 h-6 text-red-500 feedback-animation';
                 player.classList.add('shake-animation');
                 setTimeout(() => startMathPathLevel(currentMathLevelData.level), 1500);
            }
        }
    }
    
    function movePlayer(stoneElement) {
        const player = document.getElementById('math-path-player');
        if (!stoneElement) { // Initial position at the top middle
            player.style.left = '50%';
            player.style.top = '0%';
        } else {
            player.style.left = `${stoneElement.offsetLeft + stoneElement.offsetWidth / 2}px`;
            player.style.top = `${stoneElement.offsetTop + stoneElement.offsetHeight / 2}px`;
        }
    }
    
    function unlockBadge(badgeKey) {
        const title = translations[currentLanguage].badge_unlocked || "Badge Unlocked!";
        const badgeName = translations[currentLanguage][badgeKey] || badgeKey.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        setTimeout(() => alert(`${title}\n${badgeName}`), 500);
    }


    // ===================================================================
    // 7. Teacher Dashboard Logic
    // ===================================================================
    let modeChart, scoresChart;
    const allStudentData = [
        { id: 'stud1', name: 'Priya Sharma', progress: { stemVillage: 2, knowledgeBattle: 1250, buildLab: true, mathPath: 2 } },
        { id: 'stud2', name: 'Rohan Singh', progress: { stemVillage: 1, knowledgeBattle: 1100, buildLab: false, mathPath: 1 } },
        { id: 'stud3', name: 'Aisha Khan', progress: { stemVillage: 3, knowledgeBattle: 980, buildLab: true, mathPath: 4 } },
        { id: 'stud4', name: 'Vikram Mehta', progress: { stemVillage: 0, knowledgeBattle: 450, buildLab: false, mathPath: 0 } }
    ];

    function renderTeacherDashboard() {
        // --- Render Charts ---
        const modeCtx = document.getElementById('mode-engagement-chart').getContext('2d');
        const scoresCtx = document.getElementById('quiz-scores-chart').getContext('2d');
        if (modeChart) modeChart.destroy();
        if (scoresChart) scoresChart.destroy();
        modeChart = new Chart(modeCtx, {
            type: 'pie', data: { labels: ['STEM Village', 'Knowledge Battle', 'Virtual Lab', 'Math Path'], datasets: [{ data: [120, 85, 45, 95], backgroundColor: ['#3b82f6', '#f97316', '#8b5cf6', '#14b8a6'] }] }, options: { responsive: true }
        });
        scoresChart = new Chart(scoresCtx, {
            type: 'bar', data: { labels: ['Physics', 'Biology', 'Chemistry'], datasets: [{ label: 'Average Score (%)', data: [78, 85, 72], backgroundColor: '#16a34a' }] }, options: { scales: { y: { beginAtZero: true, max: 100 } } }
        });
        
        // --- Render Leaderboard ---
        const leaderboardBody = document.getElementById('leaderboard-body');
        leaderboardBody.innerHTML = '';
        const sortedStudents = [...allStudentData].sort((a, b) => b.progress.knowledgeBattle - a.progress.knowledgeBattle);
        sortedStudents.forEach((student, index) => {
            const row = document.createElement('tr');
            row.className = index % 2 === 0 ? 'bg-white border-b' : 'bg-slate-50 border-b';
            row.innerHTML = `<td class="px-6 py-4 font-medium">${index + 1}</td><td class="px-6 py-4">${student.name}</td><td class="px-6 py-4">${student.progress.knowledgeBattle}</td>`;
            leaderboardBody.appendChild(row);
        });

        // --- Render Individual Progress Cards ---
        const container = document.getElementById('student-progress-container');
        container.innerHTML = '';
        allStudentData.forEach(student => {
            const card = document.createElement('div');
            card.className = 'bg-slate-50 border rounded-lg p-4 shadow';
            const labStatus = student.progress.buildLab ? 'Completed ‚úÖ' : 'Not Completed ‚ùå';
            card.innerHTML = `
                <h3 class="text-lg font-bold text-slate-700">${student.name}</h3>
                <p class="text-sm text-slate-600 mt-2">STEM Village: ${student.progress.stemVillage} / 3 buildings unlocked</p>
                <p class="text-sm text-slate-600">Knowledge Battle High Score: ${student.progress.knowledgeBattle}</p>
                <p class="text-sm text-slate-600">Virtual Lab Circuit: ${labStatus}</p>
                <p class="text-sm text-slate-600">Highest Math Path Level: ${student.progress.mathPath}</p>
            `;
            container.appendChild(card);
        });
    }

    function exportData() {
        const headers = ["student_id", "student_name", "stem_village_unlocked", "knowledge_battle_score", "build_lab_completed", "math_path_level"];
        const rows = allStudentData.map(s => [s.id, s.name, s.progress.stemVillage, s.progress.knowledgeBattle, s.progress.buildLab, s.progress.mathPath].join(','));
        let csvContent = "data:text/csv;charset=utf-8," + headers.join(",") + "\n" + rows.join("\n");
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", "student_progress_export.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    </script>
</body>
</html>